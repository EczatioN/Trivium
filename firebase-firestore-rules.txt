rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /excercises/{excercise} {
    	// Only allow reads from excercises if user is authenticated.
      allow read:
      	if request.auth != null;
      // Only allow writes to excercises if user is in admin collection.
      allow write:
      	if 
        	exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }
    match /excercises/{excercise}/assignments/{id} {
    	// Only allow reads from assignments if user is authenticated.
      allow read:
      	if request.auth != null;
      // Only allow writes to assignments if user is in admin collection.
      allow write:
      	if 
        	exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }
    match /excercises/{excercise}/user-answers/{uid} {
    	// Only allow reads and writes from and to user-answers if user is accessing their own answers.
      allow read, write:
      	if request.auth.uid != null;
    }
    match /users/{uid} {
    	// Only allow reads and writes from and to users if user is accessing their own document.
    	allow read, write:
    		if request.auth.uid != null;
    }
    match /admins/{uid} {
    	// Only allow reads from admins if user is authenticated.
    	allow read:
    		if request.auth != null;
    }
  }
}